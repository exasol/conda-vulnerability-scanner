import io

from conda_security_scanner.scanner import generate_plaintext_report, CVE


def test_generate_plaintext_report():
    """
    This test checks the plaintext report generation for the given cves
    """
    input = [CVE(cve='CVE-2022-29191', cvss='5.5', cvss2='2.1', cvss3='5.5', cwe='CWE-20',
                 cpe='cpe:/a:google:tensorflow:2.8.0'),
             CVE(cve='CVE-2022-29192', cvss='5.5', cvss2='2.1', cvss3='5.5', cwe='CWE-20',
                 cpe='cpe:/a:google:tensorflow:2.8.0'),
             CVE(cve='CVE-2022-29193', cvss='5.5', cvss2='2.1', cvss3='5.5', cwe='CWE-20',
                 cpe='cpe:/a:google:tensorflow:2.8.0')]

    fileobj = io.StringIO()
    generate_plaintext_report(input, fileobj)
    actual_output = "\n" + fileobj.getvalue()
    expected_output = """
_______________________________| _______________| _____| ______| ______| _______| ________________________________________________
cpe                            | cve            | cvss | cvss2 | cvss3 | cwe    | url                                             
_______________________________| _______________| _____| ______| ______| _______| ________________________________________________
cpe:/a:google:tensorflow:2.8.0 | CVE-2022-29191 | 5.5  | 2.1   | 5.5   | CWE-20 | https://nvd.nist.gov/vuln/detail/CVE-2022-29191 
cpe:/a:google:tensorflow:2.8.0 | CVE-2022-29192 | 5.5  | 2.1   | 5.5   | CWE-20 | https://nvd.nist.gov/vuln/detail/CVE-2022-29192 
cpe:/a:google:tensorflow:2.8.0 | CVE-2022-29193 | 5.5  | 2.1   | 5.5   | CWE-20 | https://nvd.nist.gov/vuln/detail/CVE-2022-29193 
"""
    assert expected_output == actual_output
