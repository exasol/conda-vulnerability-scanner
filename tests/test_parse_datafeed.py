import importlib.resources
from pathlib import Path

from _pytest.fixtures import fixture

from conda_security_scanner.scanner import parse_nvd_datafeed

expected_links = ['/feeds/json/cve/1.1/nvdcve-1.1-modified.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-recent.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2022.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2021.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2020.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2019.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2018.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2017.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2016.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2015.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2014.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2013.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2012.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2011.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2010.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2009.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2008.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2007.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2006.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2005.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2004.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2003.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2002.json.gz']


@fixture
def data_feeds_html() -> str:
    return importlib.resources.read_text("tests.resources", "test_data_feeds.html")


def test_parse_nvd_datafeed(data_feeds_html):
    html = data_feeds_html
    links = parse_nvd_datafeed(html)
    assert links == expected_links
