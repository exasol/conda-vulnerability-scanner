import tempfile
from pathlib import Path

from conda_security_scanner.scanner import fetch_db, scan


def test_fetch_db():
    script_directory = Path(__file__).parent
    with tempfile.TemporaryDirectory() as temp_dir:
        db_dir = Path(temp_dir)
        fetch_db(db_dir)
        cves = scan(db_dir, script_directory / "resources/mamba_list.json")
        assert len(cves) > 0
