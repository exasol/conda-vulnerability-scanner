from conda_vulnerability_scanner.scanner import filter_by_cve_severity, CVE, Severity

input_cves = [
    CVE(cve='CVE-2022-1', cvss=f'{float(i / 10)}', cvss2='', cvss3='',
        cwe='CWE-20', cpe='cpe:/a:google:tensorflow:2.8.0')
    for i in range(0, 101, 1)
]


def test_severity_none():
    filtered_cves = filter_by_cve_severity(cves=input_cves, severity=Severity.NONE)
    assert filtered_cves == input_cves


def test_severity_low():
    filtered_cves = filter_by_cve_severity(cves=input_cves, severity=Severity.LOW)
    assert filtered_cves == input_cves[1:]


def test_severity_medium():
    filtered_cves = filter_by_cve_severity(cves=input_cves, severity=Severity.MEDIUM)
    assert filtered_cves == input_cves[40:]


def test_severity_high():
    filtered_cves = filter_by_cve_severity(cves=input_cves, severity=Severity.HIGH)
    assert filtered_cves == input_cves[70:]


def test_severity_critical():
    filtered_cves = filter_by_cve_severity(cves=input_cves, severity=Severity.CRITICAL)
    assert filtered_cves == input_cves[90:]


def test_cvss_not_float():
    not_float_input_cves = [CVE(cve='CVE-2022-1', cvss=f'', cvss2='', cvss3='',
                                cwe='CWE-20', cpe='cpe:/a:google:tensorflow:2.8.0'),
                            CVE(cve='CVE-2022-1', cvss=f'abc', cvss2='', cvss3='',
                                cwe='CWE-20', cpe='cpe:/a:google:tensorflow:2.8.0')
                            ]
    filtered_cves = filter_by_cve_severity(cves=not_float_input_cves, severity=Severity.Critical)
    assert filtered_cves == not_float_input_cves
