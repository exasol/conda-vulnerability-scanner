import json
import sqlite3
from pathlib import Path

from conda_security_scanner.scanner import lookup_cpes_for_packages


def test_lookup_cpes_for_packages(test_package_list_path, test_sqlite_path):
    with open(test_package_list_path) as f:
        packages = json.load(f)
    con = sqlite3.connect(test_sqlite_path)
    result = lookup_cpes_for_packages(packages[:], con)
    assert result == {('google', 'tensorflow', '2.8.0'), ('tensorflow', 'tensorflow', '2.8.0')}
