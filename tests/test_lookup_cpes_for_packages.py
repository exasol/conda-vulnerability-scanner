import json
import sqlite3
from pathlib import Path

from conda_security_scanner.scanner import lookup_cpes_for_packages


def test_lookup_cpes_for_packages():
    script_directory = Path(__file__).parent
    with open(script_directory / "resources/mamba_list.json") as f:
        packages = json.load(f)
    sqlite_file = script_directory / "resources/test_db/cpe.sqlite3"
    con = sqlite3.connect(sqlite_file)
    result = lookup_cpes_for_packages(packages[:], con)
    assert result == {('google', 'tensorflow', '2.8.0'), ('tensorflow', 'tensorflow', '2.8.0')}
