import tempfile
from pathlib import Path

from conda_security_scanner.scanner import download_all_nvd_datafeed_files
from tests.test_parse_datafeed import expected_links


def test_download_all_nvd_datafeed_files():
    with tempfile.TemporaryDirectory() as temp_dir:
        output_dir = Path(temp_dir)
        files = download_all_nvd_datafeed_files(expected_links, output_dir)
        expected_file_names = sorted([Path(link).name for link in expected_links])
        actual_file_names = sorted([file.name for file in output_dir.glob("*")])
        sorted_files = sorted(files)
        sorted_glob = sorted(output_dir.glob("*"))
        assert actual_file_names == expected_file_names and sorted_glob == sorted_files
