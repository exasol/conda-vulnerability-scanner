import tempfile
from pathlib import Path

from conda_security_scanner.scanner import download_all_nvd_datafeed_files

expected_links = ['/feeds/json/cve/1.1/nvdcve-1.1-2022.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2021.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2020.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2019.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2018.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2017.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2016.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2015.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2014.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2013.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2012.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2011.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2010.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2009.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2008.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2007.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2006.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2005.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2004.json.gz', '/feeds/json/cve/1.1/nvdcve-1.1-2003.json.gz',
                  '/feeds/json/cve/1.1/nvdcve-1.1-2002.json.gz']


def test_download_all_nvd_datafeed_files():
    with tempfile.TemporaryDirectory() as temp_dir:
        output_dir = Path(temp_dir)
        files = download_all_nvd_datafeed_files(output_dir)
        expected_file_names = sorted([Path(link).name for link in expected_links])
        actual_file_names = sorted([file.name for file in output_dir.glob("*")])
        sorted_files = sorted(files)
        sorted_glob = sorted(output_dir.glob("*"))
        assert actual_file_names == expected_file_names and sorted_glob == sorted_files
