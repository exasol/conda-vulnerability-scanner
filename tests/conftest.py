import contextlib
import sqlite3
from pathlib import Path

import pytest
from _pytest.fixtures import fixture


@fixture
def test_resource_path() -> Path:
    script_directory = Path(__file__).parent / "resources"
    return script_directory


@fixture
def test_db_path(test_resource_path) -> Path:
    return test_resource_path / "test_db"


@fixture
def test_package_list_path(test_resource_path) -> Path:
    return test_resource_path / "mamba_list.json"


@fixture
def test_data_feed_file_path(test_db_path) -> Path:
    return test_db_path / "nvdcve-1.1-2022.json.gz"


@fixture
def test_sqlite_path(test_db_path) -> Path:
    return test_db_path / "cpe.sqlite3"


@pytest.fixture
def test_sqlite_connection(test_sqlite_path) -> sqlite3.Connection:
    with contextlib.closing(sqlite3.connect(test_sqlite_path)) as con:
        yield con
